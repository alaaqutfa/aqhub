(()=>{var e=function(e){"undefined"!=typeof Theme?Theme.showError(e):console.error("[Review]",e)},a=function(e){"undefined"!=typeof Theme?Theme.showSuccess(e):console.log("[Review]",e)},n=function(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"undefined"!=typeof Theme?Theme.handleError(e,n):console.error("[Review]",(null===(a=e.responseJSON)||void 0===a?void 0:a.message)||e.statusText||e)},t=function(){"undefined"!=typeof Theme&&Theme.lazyLoadInstance&&Theme.lazyLoadInstance.update()},r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&e.length){var a=e.find('input[name="_token"]').val();if(a)return a}return $('meta[name="csrf-token"]').attr("content")||""};$(function(){var o,i=$(".review-list-container"),s=[],l=function(e){e.lightGallery({thumbnail:!0})},d=function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e){var r=new URL(e,window.location.origin);Object.keys(n).forEach(function(e){n[e]&&r.searchParams.set(e,n[e])}),$.ajax({url:r.toString(),method:"GET",beforeSend:function(){i.append('<div class="loading-spinner"></div>')},success:function(e){var n=e.data,r=e.message;i.find("h4").text(r),i.find(".review-list").html(n),t(),l(i.find(".review-images")),a&&a()},error:function(){},complete:function(){i.find(".loading-spinner").remove()}})}},c=function(){return{search:$(".review-search-input").val()||"",sort_by:$(".review-sort-select").val()||"newest",star:$(".review-star-filter").val()||""}},v=function(){var e=""!==$(".review-search-input").val().trim(),a=""!==$(".review-star-filter").val(),n="newest"!==$(".review-sort-select").val();e||a||n?$(".review-clear-btn").removeClass("d-none"):$(".review-clear-btn").addClass("d-none")},u=function(e){for(var a=new ClipboardEvent("").clipboardData||new DataTransfer,n=0,t=s;n<t.length;n++){var r=t[n];a.items.add(r)}e.files=a.files,function(e){var a=$(".image-upload__text"),n=$(e).data("max-files"),t=e.files.length;n?(t>=n?a.closest(".image-upload__uploader-container").addClass("d-none"):a.closest(".image-upload__uploader-container").removeClass("d-none"),a.text(t+"/"+n)):a.text(t);var r=$(".image-viewer__list"),o=$("#review-image-template").html();if(r.find(".image-viewer__item").remove(),t){for(var i=t-1;i>=0;i--)r.prepend(o.replace("__id__",i));for(var s=function(a){var n=new FileReader;n.onload=function(e){r.find(".image-viewer__item[data-id="+a+"]").find("img").attr("src",e.target.result)},n.readAsDataURL(e.files[a])},l=t-1;l>=0;l--)s(l)}}(e)};i.length&&(l($(".review-images")),d(i.data("ajax-url"),null,c())),i.on("click",".pagination a",function(e){e.preventDefault();var a=$(e.currentTarget).prop("href");d(a,function(){$("html, body").animate({scrollTop:i.offset().top-130})},c())}),$(document).on("submit",".product-review-container form",function(t){t.preventDefault(),t.stopPropagation();var r=$(t.currentTarget),o=r.find('button[type="submit"]');$.ajax({type:"POST",cache:!1,url:r.prop("action"),data:new FormData(r[0]),contentType:!1,processData:!1,beforeSend:function(){o.prop("disabled",!0).addClass("loading")},success:function(n){var t=n.error,o=n.message;t?e(o):(r.find("select").val(0),r.find("textarea").val(""),r.find("input[type=file]").val(""),r.find("input.custom-field").val(""),s=[],a(o),d(i.data("ajax-url"),function(){$(".review-list").length||setTimeout(function(){return window.location.reload()},1e3)},c()))},error:function(e){n(e,r)},complete:function(){o.prop("disabled",!1).removeClass("loading")}})}),$(document).on("change",".product-review-container form input[type=file]",function(a){a.preventDefault();var n=this,t=$(n),r=t.data("max-size");Object.keys(n.files).map(function(a){if(r&&n.files[a].size/1024>r){var o=t.data("max-size-message").replace("__attribute__",n.files[a].name).replace("__max__",r);e(o)}else s.push(n.files[a])});var o=s.length,i=t.data("max-files");i&&o>i&&s.splice(o-i-1,o-i),u(n)}),$(document).on("click",".product-review-container form .image-viewer__icon-remove",function(e){e.preventDefault();var a=$(e.currentTarget).closest(".image-viewer__item").data("id");s.splice(a,1);var n=$(".product-review-container form input[type=file]")[0];u(n)}),$(document).on("click",".delete-review-btn",function(n){n.preventDefault();var t=$(this),o=t.data("review-id"),s=t.data("confirm-message");if(confirm(s)){var l="/review/delete/".concat(o);$.ajax({url:l,type:"DELETE",headers:{"X-CSRF-TOKEN":r()},beforeSend:function(){t.prop("disabled",!0).addClass("loading")},success:function(e){var n=e.message;a(n),d(i.data("ajax-url"),function(){$(".review-list .review-item").length||setTimeout(function(){return window.location.reload()},1e3)},c())},error:function(a){var n="An error occurred while deleting the review.";a.responseJSON&&a.responseJSON.message&&(n=a.responseJSON.message),e(n)},complete:function(){t.prop("disabled",!1).removeClass("loading")}})}}),$(document).on("input",'[data-bb-toggle="review-search"]',function(){clearTimeout(o),o=setTimeout(function(){v(),i.length&&d(i.data("ajax-url"),null,c())},500)}),$(document).on("change",'[data-bb-toggle="review-sort"]',function(){v(),i.length&&d(i.data("ajax-url"),null,c())}),$(document).on("change",'[data-bb-toggle="review-star-filter"]',function(){v(),i.length&&d(i.data("ajax-url"),null,c())}),$(document).on("click",'[data-bb-toggle="review-star-filter-bar"]',function(){var e=$(this).data("star");$(".review-star-filter").val(e),i.length&&d(i.data("ajax-url"),null,c())}),$(document).on("keydown",'[data-bb-toggle="review-star-filter-bar"]',function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$(this).click())}),$(document).on("click",'[data-bb-toggle="review-search-toggle"]',function(){var e=$(".review-search-container"),a=$(this);e.hasClass("d-none")?($(".review-filter-container, .review-sort-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),e.removeClass("d-none"),a.addClass("active"),$(".review-search-input").focus()):(e.addClass("d-none"),a.removeClass("active")),v()}),$(document).on("click",'[data-bb-toggle="review-filter-toggle"]',function(){var e=$(".review-filter-container"),a=$(this);e.hasClass("d-none")?($(".review-search-container, .review-sort-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),e.removeClass("d-none"),a.addClass("active")):(e.addClass("d-none"),a.removeClass("active")),v()}),$(document).on("click",'[data-bb-toggle="review-sort-toggle"]',function(){var e=$(".review-sort-container"),a=$(this);e.hasClass("d-none")?($(".review-search-container, .review-filter-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),e.removeClass("d-none"),a.addClass("active")):(e.addClass("d-none"),a.removeClass("active")),v()}),$(document).on("click",'[data-bb-toggle="review-clear-filters"]',function(){$(".review-search-input").val(""),$(".review-star-filter").val(""),$(".review-sort-select").val("newest"),$(".review-search-container, .review-filter-container, .review-sort-container").addClass("d-none"),$(".review-control-buttons .btn").removeClass("active"),v(),i.length&&d(i.data("ajax-url"),null,c())}),$(document).on("click",".vendor-reply-toggle-btn",function(){var e=$(this).data("review-id"),a=$('.vendor-reply-form[data-review-id="'.concat(e,'"]'));$(this).addClass("d-none"),a.removeClass("d-none"),a.find("textarea").focus()}),$(document).on("click",".vendor-reply-cancel-btn",function(){var e=$(this).data("review-id"),a=$('.vendor-reply-form[data-review-id="'.concat(e,'"]')),n=$('.vendor-reply-toggle-btn[data-review-id="'.concat(e,'"]'));a.addClass("d-none"),a.find("textarea").val(""),n.removeClass("d-none")}),$(document).on("click",".vendor-reply-submit-btn",function(n){n.preventDefault(),n.stopPropagation();var t=$(this),o=t.data("review-id"),i=$('.vendor-reply-form[data-review-id="'.concat(o,'"]')),s=i.data("url"),l=i.find(".vendor-reply-message").val();return l&&l.trim()?($.ajax({url:s,type:"POST",data:{message:l},headers:{"X-CSRF-TOKEN":r()},beforeSend:function(){t.prop("disabled",!0).addClass("loading")},success:function(n){var r=n.error,o=n.message;r?(e(o),t.prop("disabled",!1).removeClass("loading")):(a(o),setTimeout(function(){window.location.reload()},1e3))},error:function(a){var n="An error occurred while submitting the reply.";a.responseJSON&&a.responseJSON.message&&(n=a.responseJSON.message),e(n),t.prop("disabled",!1).removeClass("loading")}}),!1):(e("Please enter a reply message."),!1)}),$(document).on("click",".vendor-delete-reply-btn",function(n){n.preventDefault();var t=$(this),o=t.data("url"),i=t.data("confirm-message");confirm(i)&&$.ajax({url:o,type:"DELETE",headers:{"X-CSRF-TOKEN":r()},beforeSend:function(){t.prop("disabled",!0)},success:function(n){var r=n.error,o=n.message;r?(e(o),t.prop("disabled",!1)):(a(o),setTimeout(function(){window.location.reload()},1e3))},error:function(a){var n="An error occurred while deleting the reply.";a.responseJSON&&a.responseJSON.message&&(n=a.responseJSON.message),e(n),t.prop("disabled",!1)}})}),sessionStorage.reloadReviewsTab&&($('#product-detail-tabs a[href="#product-reviews"]').length&&new bootstrap.Tab($('#product-detail-tabs a[href="#product-reviews"]')[0]).show(),sessionStorage.reloadReviewsTab=!1)})})();