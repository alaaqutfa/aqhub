(()=>{"use strict";!function(e){function t(t,r){var a=e('<div class="validation-error text-danger small mt-1"></div>').text(r),n=t.closest(".form-group, .mb-2, .mb-3, .return-images-section, .products-selection-section");n.length?n.append(a):t.after(a)}e(document).on("change",".select-return-item-qty",function(t){var r=e(t.currentTarget),a=r.find(":selected");a.length&&r.closest(".return-product-controls").find(".return-amount").html(a.data("amount"))}),e(document).ready(function(){var r=e("#order-return-request-form");r.length&&(function(t){var r=t.find(".return-image-file-input"),a=t.find(".return-image-preview-list"),n=t.find(".return-image-upload-box");if(!r.length||!a.length)return;var i=parseInt(r.data("max-files"))||3,s=parseInt(r.data("max-size"))||2048,o=r.data("max-size-message")||"File is too large",l=r.data("max-files-message")||"Maximum files exceeded",d=new DataTransfer;function u(){var e=a.find(".return-image-preview-item").length;e>0?a.addClass("has-images"):a.removeClass("has-images"),e>=i?n.hide():n.show()}function f(e){var r=t.find(".return-image-error");r.length?(r.text(e).show(),setTimeout(function(){r.fadeOut()},5e3)):alert(e)}r.on("change",function(t){var n=Array.from(t.target.files),m=a.find(".return-image-preview-item").length;n.forEach(function(t,n){if(m+n>=i)f(l.replace(":max",i));else if(t.size>1024*s)f(o.replace(":attribute",t.name).replace(":max",s+"KB"));else{var c=new FileReader;c.onload=function(i){var s=e("#return-image-template").html(),o=Date.now()+"_"+n,l=e(s.replace(/__id__/g,o));l.find("img").attr("src",i.target.result),l.data("file-id",o),a.find(".return-image-upload-box").before(l),d.items.add(t),r[0].files=d.files,u()},c.readAsDataURL(t)}}),t.target.value=""}),a.on("click",".return-image-remove-btn",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).closest(".return-image-preview-item"),i=a.find(".return-image-preview-item").index(n);n.remove();var s=new DataTransfer;Array.from(d.files).forEach(function(e,t){t!==i&&s.items.add(e)}),d=s,r[0].files=d.files,u()})}(r),function(r){r.on("submit",function(a){var n=!1,i=[];r.find(".validation-error").remove(),r.find(".is-invalid").removeClass("is-invalid");var s=r.find(".order-return-reason-select");(s.length&&!s.val()&&(n=!0,s.addClass("is-invalid"),t(s,s.data("error-message")||"Please select a return reason."),i.push("reason")),r.find('.return-product-controls select[name*="[reason]"]').each(function(){var r=e(this);r.closest(".return-product-card").find('input[type="checkbox"]').is(":checked")&&!r.val()&&(n=!0,r.addClass("is-invalid"),t(r,r.data("error-message")||"Please select a return reason."),i.push("item-reason"))}),0===r.find('.return-products-list input[type="checkbox"]:checked').length)&&(n=!0,t(r.find(".return-products-list"),"Please select at least one product to return."),i.push("products"));var o=r.find(".return-image-file-input");if(o.length){var l=parseInt(o.data("max-files"))||3;if(o[0].files.length>l){n=!0;var d=o.data("max-files-message")||"The Return Images must not have more than :max items.";t(r.find(".return-image-upload-wrapper"),d.replace(":max",l)),i.push("images")}}if(n){a.preventDefault();var u=r.find(".validation-error:first, .is-invalid:first").first();u.length&&e("html, body").animate({scrollTop:u.offset().top-100},300)}}),r.on("change","select, input",function(){var t=e(this);t.removeClass("is-invalid"),t.closest(".form-group, .mb-2, .mb-3").find(".validation-error").remove()})}(r))})}(jQuery)})();